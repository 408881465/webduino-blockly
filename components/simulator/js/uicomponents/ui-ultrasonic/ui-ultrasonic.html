<template id="ultrasonic">
  <style>
  img {
    width: 240px;
    height: 140px;
    margin: 20px;
  }
  
  .pinText {
    float: left;
    margin: -20px 0 0 40px;
  }
  
  #set-input {
    pointer-events: auto!important;
    width:120px;
  }
  </style>
  <img  width="96" height="96"  src="data:image/jpeg;base64,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" />
  <div class='pinText'>
    <span id="set-input-value">30</span>CM
    <input type="range" min="0" max="180" step="1" value="30" id="set-input">
    <br> trig:<span id='trig'></span>,echo:<span id='echo'></span></div>
</template>
<script>
var doc = (document._currentScript || document.currentScript).ownerDocument;
var ultraSonicTemplate = doc.querySelector('#ultrasonic');

customElements.define('ui-ultrasonic', class extends HTMLElement {
  constructor() {
    super();
    const root = this.attachShadow({
      mode: 'closed'
    });
    const temp = document.importNode(ultraSonicTemplate.content, true);
    root.appendChild(temp);
    this.root = root;
    this.setting(this);
  }

  setting(self) {
    self.distance = 30;
    self.root.querySelector("#set-input").oninput = function(e) {
      self.distance = e.path[0].value;
      self.root.querySelector("#set-input-value").innerHTML = self.distance;
    };
  }

  setEngine(engine) {
    this.engine = engine;
    var self = this;
    this.engine.board.on(webduino.BoardEvent.SYSEX_MESSAGE, function(data) {
      data = data.message;
      // data[1]: Trigger , data[2]: Echo
      if (data[0] == 1 /*UltraSonic*/ && data[1] == self.trig && data[2] == self.echo) {
        self.engine.board.sendSysex(1, self.getReturnInfo(self));
      }
    });
  }

  getReturnInfo(self) {
    window.qq = self;
    console.log("self.distance",self.distance);
    var data = [self.trig, self.echo];
    var str = ""+self.distance;
    for (var i = 0; i < str.length; i++) {
      data.push(str.charCodeAt(i));
    }
    return data;
  }

  pin(trig, echo) {
    this.trig = trig;
    this.echo = echo;
    this.root.querySelector("#trig").innerHTML = trig;
    this.root.querySelector("#echo").innerHTML = echo;
  }

});
</script>